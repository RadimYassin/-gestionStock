<div class="relative p-6 rounded-lg bg-gray-100">
  <h2 class="text-blue-600 text-xl font-bold mb-4">Entéte</h2>

  <!-- Form Section -->
  <form (ngSubmit)="onSubmit()">
    <!-- First Grid Section -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
      <div class="flex flex-col items-center">
        <label class="block text-sm font-medium text-gray-700 text-center" for="reference">Référence:</label>
        <input type="text" id="reference" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm text-center"
               [(ngModel)]="formModel.REFERENCE" name="reference" />
      </div>
      <div class="flex flex-col items-center">
        <label class="block text-sm font-medium text-gray-700 text-center" for="livraisonDate">Date:</label>
        <input type="date" id="livraisonDate" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm text-center"
               [(ngModel)]="formModel.LIVRAISON_DATE" name="livraisonDate" />
      </div>
      <div class="flex flex-col items-center">
        <label class="block text-sm font-medium text-gray-700 text-center" for="client">Client:</label>
        <input type="text" id="client" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm text-center"
               [(ngModel)]="formModel.CLIENT_ID" name="client" />
      </div>
      <div class="flex flex-col items-center">
        <label class="block text-sm font-medium text-gray-700 text-center" for="additionalField">Nom du client:</label>
        <input type="text" id="additionalField" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm text-center"
               [(ngModel)]="formModel.CLIENT_NOM" name="additionalField" />
      </div>
    </div>

    <!-- Second Grid Section -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
      <div class="flex flex-col items-center">
        <label class="block text-sm font-medium text-gray-700 text-center">Employé:</label>
        <select class="mt-1 block w-full rounded-md border-gray-300 shadow-sm text-center"
                [(ngModel)]="formModel.EmployeeId" name="employe">
          <option *ngFor="let user of users" [value]="user.USER_ID">{{ user.NOM }}</option>
        </select>
      </div>
      <div class="flex flex-col items-center">
        <label class="block text-sm font-medium text-gray-700 text-center">Tarif:</label>
        <select class="mt-1 block w-full rounded-md border-gray-300 shadow-sm text-center"
                [(ngModel)]="formModel.tarif" name="tarif">
          <option></option>
        </select>
      </div>
      <div class="flex flex-col items-center">
        <label class="block text-sm font-medium text-gray-700 text-center">Dépôt:</label>
        <select class="mt-1 block w-full rounded-md border-gray-300 shadow-sm text-center"
                [(ngModel)]="formModel.DEPOT_ID" name="depot">
          <option *ngFor="let depot of depots" [value]="depot.DEPOT_ID">{{ depot.DEPOT_LIBELE }}</option>
        </select>
      </div>
      <div class="flex flex-col">
        <label class="block text-sm font-medium text-gray-700 text-center">Validation:</label>
        <div class="flex items-center mt-1 space-x-2">
          <input type="checkbox" class="form-checkbox" [(ngModel)]="formModel.VALIDATION" name="validation" />
          <input type="date" class="block w-full rounded-md border-gray-300 shadow-sm text-center"
                 [(ngModel)]="formModel.VALIDATION_DATE" name="validationDate" />
        </div>
      </div>
    </div>

    <!-- Third Grid Section -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
      <div class="flex flex-col items-center">
        <label class="block text-sm font-medium text-gray-700 text-center">Bon origine:</label>
        <input type="text" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm text-center"
               [(ngModel)]="formModel.bonOrigine" name="bonOrigine" />
      </div>
      <div class="flex flex-col items-center">
        <label class="block text-sm font-medium text-gray-700 text-center">Methode:</label>
        <select class="mt-1 block w-full rounded-md border-gray-300 shadow-sm text-center"
                [(ngModel)]="formModel.methode" name="methode">
          <option *ngFor="let m of methode" [value]="m.MODE_PAIMENT_ID">{{ m.MODE_PAIMANT }}</option>
        </select>
      </div>
      <div class="flex flex-col items-center">
        <label class="block text-sm font-medium text-gray-700 text-center">Condition:</label>
        <select class="mt-1 block w-full rounded-md border-gray-300 shadow-sm text-center"
                [(ngModel)]="formModel.CONDITIONS_REGLEMENT_ID" name="condition">
          <option *ngFor="let Conditions of venteConditions" [value]="Conditions.CONDTION_ID">{{ Conditions.CONDITION_LIBELE }}</option>
        </select>
      </div>
      <div class="flex flex-col">
        <label class="block text-sm font-medium text-gray-700 text-center">Échéance:</label>
        <div class="flex items-center mt-1 space-x-2">
          <input type="checkbox" class="form-checkbox" name="echeance" />
          <input type="date" class="block w-full rounded-md border-gray-300 shadow-sm text-center"
                 [(ngModel)]="formModel.ECHEANCE" name="echeanceDate" />
        </div>
      </div>
    </div>

    <!-- Single Produit Form Section -->
    <div class="bg-gray-50 p-4 rounded-lg mb-4">
      <p class="text-blue-600 text-lg font-semibold mb-4">Détails du produit</p>
      <div class="grid grid-cols-1 md:grid-cols-12 gap-4">
        <div class="col-span-12 md:col-span-3">
          <label class="block text-sm font-medium text-gray-700">Réf/CàB:</label>
          <input type="text" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"
                 [(ngModel)]="produit.refCab" name="refCab" />
        </div>
        <div class="col-span-12 md:col-span-9">
          <label class="block text-sm font-medium text-gray-700">Sélectionner un article:</label>
          <select class="mt-1 block w-full rounded-md border-gray-300 shadow-sm text-center"
                  [(ngModel)]="produit.article" name="article">
            <option *ngFor="let article of articles" [value]="article.PRODUIT_ID">{{ article.NOM1 }}</option>
          </select>
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-12 gap-4 mt-4">
        <div class="col-span-6 md:col-span-2">
          <label class="block text-sm font-medium text-gray-700" (ngModelChange)="calculateTotals()">Quantité:</label>
          <input type="number" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"
                 [(ngModel)]="produit.quantite" name="quantite" />
        </div>
        <div class="col-span-6 md:col-span-2">
          <label class="block text-sm font-medium text-gray-700" (ngModelChange)="calculateTotals()">Prix unitaire:</label>
          <input type="number" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"
                 [(ngModel)]="produit.prixUnitaire" name="prixUnitaire" />
        </div>
        <div class="col-span-6 md:col-span-2">
          <label class="block text-sm font-medium text-gray-700" (ngModelChange)="calculateTotals()">Gratuit:</label>
          <input type="number" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"
                 [(ngModel)]="produit.gratuit" name="gratuit" />
        </div>
        <div class="col-span-6 md:col-span-2">
          <label class="block text-sm font-medium text-gray-700" (ngModelChange)="calculateTotals()">Remise:</label>
          <input type="number" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"
                 [(ngModel)]="produit.TotalRemise" name="remise" />
        </div>
        <div class="col-span-6 md:col-span-2">
          <label class="block text-sm font-medium text-gray-700" (ngModelChange)="calculateTotals()">Unité:</label>
          <select class="mt-1 block w-full rounded-md border-gray-300 shadow-sm text-center"
                  [(ngModel)]="produit.unity" name="unity">
            <option *ngFor="let unity of Unity" [value]="unity.UNITE_ID">{{ unity.UNITE_LIBELE }}</option>
          </select>
        </div>
        <div class="col-span-6 md:col-span-2">
          <label class="block text-sm font-medium text-gray-700">TVA:</label>
          <select class="mt-1 block w-full rounded-md border-gray-300 shadow-sm text-center"
                  [(ngModel)]="produit.TTVA" name="tva" (ngModelChange)="calculateTotals()">
            <option *ngFor="let tva of Tva" [value]="tva.TTVA">{{ tva.LIBELE }}</option>
          </select>
        </div>
      </div>
      <!-- Button to add this produit to the details array -->

      <div class="flex flex-col md:flex-row justify-between m-6">
        <button type="button" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded mb-2 md:mb-0" (click)="addProduit()">Ajouter</button>

        <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded mb-2 md:mb-0">
          Enregistrer livraison
        </button>
      </div>
    </div>
  </form>

  <!-- Table Section -->
  <div *ngIf="formModel.details.length > 0" class="bg-white p-4 mt-4 rounded-lg shadow">
    <h3 class="text-lg font-semibold text-gray-700 mb-4">Produits</h3>
    <table class="w-full table-auto">
      <thead>
        <tr>
          <th class="px-4 py-2">Réf/CàB</th>
          <th class="px-4 py-2">Article</th>
          <th class="px-4 py-2">Quantité</th>
          <th class="px-4 py-2">Prix unitaire</th>
          <th class="px-4 py-2">Gratuit</th>
          <th class="px-4 py-2">Remise</th>
          <th class="px-4 py-2">Unité</th>
          <th class="px-4 py-2">TVA</th>
          <th class="px-4 py-2">Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let detail of formModel.details; let i = index">
          <td class="border px-4 py-2">{{ detail.refCab }}</td>
          <td class="border px-4 py-2">{{ detail.article }}</td>
          <td class="border px-4 py-2">{{ detail.quantite }}</td>
          <td class="border px-4 py-2">{{ detail.prixUnitaire }}</td>
          <td class="border px-4 py-2">{{ detail.gratuit }}</td>
          <td class="border px-4 py-2">{{ detail.TotalRemise }}</td>
          <td class="border px-4 py-2">{{ detail.unity }}</td>
          <td class="border px-4 py-2">{{ detail.TTVA }}</td>
          <td class="border px-4 py-2">
            <button type="button" class="bg-red-500 text-white px-2 py-1 rounded" (click)="removeProduit(i)">Supprimer</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Fixed Bottom Div -->
  <div class="p-5 flex bg-gray-100 justify-end gap-5 rounded-lg">
    <p class="text-right font-bold text-blue-700">TOTAL HT: {{ formModel.TotalHT }} dh </p>
    <p class="text-right font-bold text-blue-700">TVA: {{ formModel.TOTAL_TVA }} dh </p>
    <p class="text-right font-bold text-blue-700">TOTAL TTC: {{ formModel.MONTANT_TOTAL }} dh </p>
  </div>
</div>
